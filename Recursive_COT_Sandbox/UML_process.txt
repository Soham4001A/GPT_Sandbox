@startuml
start

:Initialize global variables;
:Load problem description and assumptions;

while (max_restarts not exceeded?) is (yes)
    :Restart reasoning process (restart loop);
    :Initialize steps and feedback log;

    if (identified assumptions exist?) then (yes)
        :Incorporate assumptions into the problem description;
    else (no)
        :Use original problem description;
    endif

    while (max_steps not exceeded?) is (yes)
        :Generate next reasoning step;
        if (step generation fails?) then (yes)
            :Log error and exit loop;
            break
        else (no)
            :Extract step output;
            :Append step reasoning and output to steps list;
        endif

        if (step signals termination?) then (yes)
            :Log early termination and exit step loop;
            break
        else (no)
            :Validate step with holistic feedback gate;
            if (feedback rejects step?) then (yes)
                :Request corrected step from GPT;
                if (correction fails?) then (yes)
                    :Log error and exit loop;
                    break
                else (no)
                    :Update reasoning with corrected step;
                endif
            else (no)
                :Accept step and proceed;
            endif
        endif
    endwhile

    :Add generated reasoning chain to list;
    :Perform global consistency check;

    if (restart instructions are provided?) then (yes)
        :Extract and update assumptions for restart;
    else (no)
        if (no additional assumptions needed?) then (yes)
            :Finalize solution;
            stop
        else (no)
            :Select most logical chain and finalize answer;
            stop
        endif
    endif
endwhile

:Return final solution;
stop
@enduml